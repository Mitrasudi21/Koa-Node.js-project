app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){t.otherwise("/list"),e.state("list",{onEnter:function(){$(".inner-nav-menu").find("a").removeClass("active"),$(".inner-nav-menu-list").addClass("active")},views:{main:{templateUrl:"/list.tpl.html",controller:"petController"}},url:"/list"}).state("create",{onEnter:function(){$(".inner-nav-menu").find("a").removeClass("active"),$(".inner-nav-menu-create").addClass("active")},views:{main:{templateUrl:"/create.tpl.html",controller:"petController"}},url:"/create"}).state("update",{onEnter:function(){$(".inner-nav-menu").find("a").removeClass("active"),$(".inner-nav-menu-update").addClass("active")},views:{main:{templateUrl:"/update.tpl.html",controller:"petController"}},url:"/update?petid"})}]);var currentState=null,currentParams=null;app.run(["$rootScope","$state","$location","$window",function(e,t,r,a){e.$on("$stateChangeStart",function(e,t,r,a,n){}),e.$on("$stateChangeError",function(e,t,r,a,n,s){}),e.$on("$stateChangeSuccess",function(e,t,r,a,n){currentState=t,currentParams=r}),e.$on("$viewContentLoaded",function(e,t,r,a,n){currentState&&0<=["update"].indexOf(currentState.name)&&setTimeout(function(){currentParams.petid&&($("#proxy-change").attr("data-currentItem",currentParams.petid),$("#proxy-change").click())},300)})}]),app.controller("petController",["$scope","$rootScope","$stateParams","dataFactory","$state","$timeout",function(r,e,t,a,n,s){r.pets=pets,r.currentPet={isActive:!0},r.currentPetOrg={isActive:!0},r.petsUnderProcessing={},r.petConfig={valueField:"_id",labelField:"name",searchField:["name"],maxOptions:25,maxItems:1,closeAfterSelect:!0},r.proxyPetChanged=function(){var e=$("#proxy-change").attr("data-currentItem");e&&(r.currentPet._id=e,r.petChanged())},r.petChanged=function(){var e=r.currentPet._id;e&&("update"!=n.current.name||-1<(e=_.findIndex(r.pets,["_id",e]))&&(r.currentPet=JSON.parse(JSON.stringify(r.pets[e])),r.currentPetOrg=JSON.parse(JSON.stringify(r.pets[e])),$("#submit_update").removeClass("disabled"),$("#reset_update").removeClass("disabled")))},r.navUpdate=function(e){n.go("update",{petid:e._id})},r.submitUpdate=function(){var e=$("#model_form").parsley();e.validate(),e.isValid()&&($("#submit_update").addClass("loading disabled"),$("#reset_update").addClass("disabled"),delete(e=JSON.parse(JSON.stringify(r.currentPet))).isActive,e={find:r.currentPet._id,update:e},a.post("update-pet.json",e).then(function(e){var t;$("#submit_update").removeClass("loading disabled"),$("#reset_update").removeClass("disabled"),e.status?(a.toastSuccess("Pet updated successfully"),0<=(t=_.findIndex(pets,["_id",r.currentPet._id]))&&(pets[t]=e.doc,r.pets=pets,r.currentPetOrg=JSON.parse(JSON.stringify(e.doc)))):a.toastError(e.msg)},function(){a.toastError("we have encounterd an unexpected error, plesae try after some time."),$("#submit_update").removeClass("loading disabled"),$("#reset_update").removeClass("disabled")}))},r.resetUpdate=function(){r.currentPet=JSON.parse(JSON.stringify(r.currentPetOrg))},r.setEnableddisabled=function(t){var e;r.petsUnderProcessing[t._id]||(r.petsUnderProcessing[t._id]=!0,$("."+t._id).parent().parent().find(".notched.circle.loading").css("visibility","visible"),$("."+t._id).checkbox(),e={find:t._id,update:{isActive:!t.isActive}},a.post("update-pet.json",e).then(function(e){e.status?(t.isActive=e.doc.isActive,s(function(){t.isActive?$("."+t._id).checkbox("check"):$("."+t._id).checkbox("uncheck"),$("."+t._id).parent().parent().find(".notched.circle.loading").css("visibility","hidden")},200)):($("."+t._id).parent().parent().find(".notched.circle.loading").css("visibility","hidden"),a.toastError(e.msg)),r.petsUnderProcessing[t._id]=!1},function(){$("."+t._id).parent().parent().find(".notched.circle.loading").hide(),a.toastError("we have encounterd an unexpected error, plesae try after some time."),r.petsUnderProcessing[t._id]=!1}))},r.submitCreate=function(){var e=$("#model_form").parsley();e.validate();e.isValid()&&($("#submit_create").addClass("loading disabled"),$("#reset_create").addClass("disabled"),a.post("create-pet.json",r.currentPet).then(function(e){$("#submit_create").removeClass("loading disabled"),$("#reset_create").addClass("disabled"),e.status?(pets.push(e.doc),r.pets=pets,r.clearCreate(),a.toastSuccess("Pet added successfully")):a.toastError(e.msg)},function(){a.toastError("we have encounterd an unexpected error, plesae try after some time."),$("#submit_create").removeClass("loading disabled")}))},r.clearCreate=function(){r.currentPet={isActive:!0}}}]);